{% extends 'base.html' %} 

{% block head %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', filename='login-stylee.css') }}">
{% endblock %}
{% block title %}Login page{% endblock %}


{% block content %}
<main class="login-page">
  <div class="login-form-wrapper">
    <h2 style="color: rgba(0, 0, 0, 0.778); display:flex;align-items: center; justify-content: center;">Login</h2>
    
    <!-- NO method, NO hidden_tag, NO form.submit -->
    <form id="loginForm">
      <input class="login-input" 
             id="usernameInput" 
             placeholder="User Name" 
             autocomplete="username" 
             required>
      
      <input class="login-input" 
             id="passwordInput" 
             type="password"
             placeholder="Password" 
             autocomplete="current-password" 
             required>
      
      <br>
      <div class="checkbox mb-3">
        <h6 style="color: rgba(0, 0, 0, 0.777); display:flex;align-items: center; justify-content: center;">
          Do not have an account?
        </h6>
        <a class="btn btn-sm btn-secondary" href="{{ url_for('register_page') }}" style="display: block;">
          Register
        </a>
      </div>
      
      <!-- Plain button, JS handles submit -->
      <button type="submit" class="login-btn">Sign In</button>
    </form>
    
    <div id="message" style="color: red;"></div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('loginForm');
      const message = document.getElementById('message');
      
      form.addEventListener('submit', async function(e) {
        e.preventDefault();  // STOP HTML form submission
        console.log('ðŸ”¥ JS Form intercepted!');
        
        const username = document.getElementById('usernameInput').value;
        const password = document.getElementById('passwordInput').value;
        
        try {
          const response = await fetch('/api/login', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({username, password})
          });
          
          console.log('Status:', response.status);
          const data = await response.json();
          console.log('Data:', data);
          
          if(response.ok && data.accessToken) {
            localStorage.setItem('accessToken', data.accessToken);
            window.location.href = '/add-expense';
          } else {
            message.textContent = data.error || 'Login failed';
          }
        } catch(error) {
          console.error('Error:', error);
          message.textContent = 'Network error';
        }
      });
    });
  </script>
</main>

{% endblock %}